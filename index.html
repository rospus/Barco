<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BARCO - Home</title>
    <!-- Include Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Include Google Font (Roboto) -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Include Google Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/index.css">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            margin: 0;
        }
        .header {
            background-color: #f8f9fa;
            padding: 10px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
        }
        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .btn-start {
            margin-top: 40px;
            background-color: #007bff;
            color: white;
        }
        .small-text {
            font-size: 0.6em;
            line-height: 1.2;
            display: inline-block;
            margin-left: 10px;
            vertical-align: top;
        }
        .gps-container {
            display: flex;
            align-items: center;
        }
    </style>
</head>
<body>
    <header class="header">BARCO</header>
    <main class="content">
        <table class="table">
            <tbody>
                <tr>
                    <td style="width: 30%;">Agenzia</td>
                    <td style="width: 50%;"></td>
                    <td style="width: 20%;"></td>
                </tr>
                <tr>
                    <td>Utente</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Punti</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>GPS</td>
                    <td id="gps-status"></td>
                    <td id="gps-accuracy"></td>
                </tr>
                <tr>
                    <td>Server</td>
                    <td id="server-status"></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
        <button class="btn btn-start" id="start-button" onclick="window.location.replace('scan.html')">INIZIO SESSIONE</button>
    </main>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const gpsStatusCell = document.getElementById('gps-status');
            const gpsAccuracyCell = document.getElementById('gps-accuracy');
            const serverStatusCell = document.getElementById('server-status');

            // GPS Check
            gpsStatusCell.innerHTML = '<span class="material-icons">autorenew</span> Recupero posizione...';

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const lat = position.coords.latitude.toFixed(6);
                        const lon = position.coords.longitude.toFixed(6);
                        const accuracy = Math.round(position.coords.accuracy);
                        const timestamp = new Date(position.timestamp).toISOString();

                        sessionStorage.setItem('lastCoordStored', JSON.stringify({ lat, lon, accuracy, timestamp }));

                        gpsStatusCell.innerHTML = `
                            <div class="gps-container">
                                <span class="material-icons" style="color: green;">gps_fixed</span>
                                <span class="small-text">
                                    ${lat}<br>${lon}
                                </span>
                            </div>
                        `;
                        gpsAccuracyCell.innerHTML = `Â±${accuracy} m`;
                    },
                    error => {
                        gpsStatusCell.innerHTML = '<span class="material-icons" style="color: red;">gps_not_fixed</span>';
                        gpsAccuracyCell.innerHTML = '';
                    }
                );
            } else {
                gpsStatusCell.innerHTML = '<span class="material-icons" style="color: red;">gps_not_fixed</span>';
                gpsAccuracyCell.innerHTML = '';
            }

            // Server Ping Check
            fetch('https://gips.xyz/incoming/in_post.php', { method: 'HEAD' })
                .then(response => {
                    if (response.ok) {
                        serverStatusCell.innerHTML = '<span class="material-icons" style="color: green;">cloud_upload</span>';
                    } else {
                        serverStatusCell.innerHTML = '<span class="material-icons" style="color: red;">cloud_off</span>';
                    }
                })
                .catch(() => {
                    serverStatusCell.innerHTML = '<span class="material-icons" style="color: red;">cloud_off</span>';
                });
        });
    </script>
    <!-- Include Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
